<!DOCTYPE html><html lang="zh-TW"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="日本包裝機維修回報單 - 快速報告和安排維修服務">
    <meta name="author" content="Leo">
    <title>日本包裝機維修回報單</title>
    
    <!-- PWA 支持 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="維修回報單">
    <meta name="theme-color" content="#909FA6" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#667780" media="(prefers-color-scheme: dark)">
    
    <!-- Manifest 連接 -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- 圖標 -->
    <link rel="icon" href="./icon-192.png">
    <link rel="apple-touch-icon" href="./icon-192.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        mainbg: '#F6F5F3',
                        maintext: '#424242',
                        buttonbg: '#EDEEF0',
                        titlebg: '#909FA6',
                        bordergray: '#424242'
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --main-bg: #F6F5F3;
            --main-text: #424242;
            --button-bg: #EDEEF0;
            --title-bg: #909FA6;
            --border-gray: #424242;
        }

        body {
            background-color: var(--main-bg);
            color: var(--main-text);
        }
        
        input, textarea {
            color: var(--main-text);
            background-color: white;
        }
        
        button {
            background-color: var(--button-bg) !important;
            color: var(--main-text) !important;
            border: 1px solid var(--border-gray) !important;
            transition: all 0.2s ease-in-out;
        }
        
        button:hover {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transform: translateY(-1px);
            opacity: 0.9;
        }

        .underlined-option {
            text-decoration: underline;
            cursor: pointer;
            color: #424242 !important;
            margin-right: 10px;
            display: inline-block;
            margin-bottom: 8px;
        }
        
        .underlined-option:active, .underlined-option:hover, .underlined-option:visited {
            color: #424242 !important;
        }

        /* 深色模式支援 */
        @media (prefers-color-scheme: dark) {
            :root {
                --main-bg: #2C3333;
                --main-text: #E3E8EB;
                --button-bg: #3E4545;
                --title-bg: #667780;
            }
            
            input, textarea {
                color: #333333; 
                background-color: #FFFFFF;
            }
            
            .shadow-md {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3) !important;
            }
        }
        
        /* 深色模式下的版本號顯示 */
        @media (prefers-color-scheme: dark) {
            .version-text {
                color: #e0e0e0;
            }
        }

        /* 安裝成功通知 */
        #installSuccess {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            display: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 300px;
        }
        
        /* iOS引導提示 */
        .ios-guide {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255,255,255,0.95);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            text-align: center;
            max-width: 90%;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 100%); }
            to { transform: translate(-50%, 0); }
        }
        
        /* 隱藏PWA相關按鈕 */
        @media all and (display-mode: standalone) {
            #addToHomeBtn {
                display: none !important;
            }
            .footer-text {
                margin-top: 3px;
            }
        }
    </style>
</head>
<body class="bg-mainbg min-h-screen">
    <!-- 安裝成功通知 -->
    <div id="installSuccess">
        <p><i class="fas fa-check-circle mr-2"></i>已成功添加到主屏幕!</p>
    </div>
    
    <!-- iOS安裝指南 -->
    <div id="iosInstallGuide" class="ios-guide">
        <div class="text-lg font-semibold mb-2">加到主屏幕</div>
        <p class="mb-2">點擊 <i class="fas fa-share-alt text-blue-500"></i> 分享按鈕，然後選擇「加到主屏幕」</p>
        <button id="closeIosGuide" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-3 py-1 rounded mt-2">
            我知道了
        </button>
    </div>
    
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <!-- 標題區 -->
        <div class="bg-titlebg text-white text-center p-4 rounded-t-lg shadow-md border border-bordergray">
            <h1 class="text-2xl font-bold">日本包裝機維修回報單</h1>
        </div>
        
        <!-- 主要內容區 -->
        <div class="bg-mainbg p-6 rounded-b-lg shadow-md mb-6 border border-t-0 border-bordergray">
            <!-- 問答區域 -->
            <div id="questionArea" class="mb-6">
                <!-- 您的问答区域代码保持不变 -->
                <!-- ... -->
            </div>
            
            <!-- 表單結果區 -->
            <div id="formResult" class="mt-8 p-4 border border-bordergray rounded-lg bg-mainbg">
                <h3 class="text-lg font-semibold text-maintext mb-3">回報單資訊</h3>
                <div class="space-y-2 text-maintext">
                    <p id="resultErrorCode">Error Code：</p>
                    <p id="resultErrorDensity">Error Code密度：</p>
                    <p id="resultMachineNumber">機身編號：</p>
                    <p id="resultCustomerInfo">客戶編號/診所名稱：</p>
                    <p id="resultDetails">其他細節：</p>
                </div>
            </div>
        </div>
        
        <!-- 版權及版本信息 -->
        <div class="text-center text-maintext text-sm flex flex-col items-center space-y-1">
            <button id="addToHomeBtn" class="inline-flex items-center text-maintext hover:underline">
                <i class="fas fa-plus-circle mr-1"></i> 加到手機主頁
            </button>
            <p class="footer-text">© 2023 日本包裝機維修系統 <span class="font-medium">v1.0.1</span></p>
        </div>
        
        <!-- 用於複製的隱藏元素 -->
        <textarea id="hiddenCopyArea" style="position: absolute; left: -9999px; top: 0;" readonly=""></textarea>
    </div>

    <!-- JavaScript -->
    <script>
        // 您的现有 JavaScript 代码保持不变...
        
        // 添加PWA相关代码
        
        // 保存安装提示事件
        let deferredPrompt;
        
        // 监听 beforeinstallprompt 事件
        window.addEventListener('beforeinstallprompt', (e) => {
            // 阻止 Chrome 自动显示安装提示
            e.preventDefault();
            
            // 保存事件，以便稍后使用
            deferredPrompt = e;
            
            // 确保添加到主屏幕按钮显示
            const addToHomeBtn = document.getElementById('addToHomeBtn');
            if (addToHomeBtn) {
                addToHomeBtn.style.display = 'inline-flex';
            }
            
            console.log('可以安装应用');
        });
        
        // 添加到主屏幕功能
        function addToHomeScreen() {
            if (deferredPrompt) {
                // 显示安装提示
                deferredPrompt.prompt();
                
                // 等待用户做出选择
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('用户接受安装');
                        // 显示成功通知
                        const successNotice = document.getElementById('installSuccess');
                        successNotice.style.display = 'block';
                        setTimeout(() => {
                            successNotice.style.display = 'none';
                        }, 3000);
                    } else {
                        console.log('用户拒绝安装');
                    }
                    deferredPrompt = null;
                });
            } else {
                // 检测是否是iOS设备
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                if (isIOS) {
                    // 显示iOS安装指南
                    document.getElementById('iosInstallGuide').style.display = 'block';
                } else {
                    // 其他平台但无法安装的情况
                    alert('此应用可能已安装或您的浏览器不支持此功能');
                }
            }
        }
        
        // 关闭iOS安装指南
        document.getElementById('closeIosGuide').addEventListener('click', function() {
            document.getElementById('iosInstallGuide').style.display = 'none';
        });
        
        // 监听 appinstalled 事件
        window.addEventListener('appinstalled', (evt) => {
            console.log('应用已安装', evt);
            document.getElementById('addToHomeBtn').style.display = 'none';
        });
        
        // 在DOM加载完成后添加事件监听
        document.addEventListener('DOMContentLoaded', function() {
            // 添加到主屏幕按钮点击事件
            document.getElementById('addToHomeBtn').addEventListener('click', addToHomeScreen);
            
            // 检查是否已经以PWA模式运行
            if (window.matchMedia('(display-mode: standalone)').matches) {
                // 如果已经安装并以独立模式运行，隐藏安装按钮
                document.getElementById('addToHomeBtn').style.display = 'none';
            }
            
            // 您的其他初始化代码...
        });
    </script>


</body></html>